# 第六章 框架开发实践

## 章节概述

本章将介绍主流的 Agent 开发框架，包括 AutoGen、AgentScope、LangGraph 等，帮助你快速搭建复杂的智能体系统。

## 学习目标

- 了解主流 Agent 框架的特点和区别
- 掌握 AutoGen 的多智能体对话
- 掌握 AgentScope 的模块化设计
- 了解 LangGraph 的图结构编排
- 能够选择合适的框架完成任务

---

## 主流框架对比

### 框架特点对比

```
┌─────────────────────────────────────────────────────────────────┐
│                  Agent 框架对比矩阵                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  框架        │ AutoGen │ AgentScope │ LangGraph │ LangChain    │
│  ├─ 多智能体   │   ★★★   │    ★★★    │    ★★     │    ★★       │
│  ├─ 易用性     │   ★★★   │    ★★★★   │    ★★★    │    ★★★★     │
│  ├─ 可视化     │   ★     │    ★★★    │    ★★★    │    ★★       │
│  ├─ 灵活性     │   ★★★   │    ★★★★   │    ★★★★★  │    ★★★★     │
│  ├─ 文档质量   │   ★★★   │    ★★★★   │    ★★★    │    ★★★★★    │
│  ├─ 生态成熟度 │   ★★★   │    ★★★    │    ★★★★   │    ★★★★★    │
│  └─ 推荐场景   │ 多智能体 │ 快速开发  │ 复杂流程   │ 通用场景    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 选择建议

```
决策流程:

你需要构建什么？

┌─────────────────────┐
│ 多智能体对话系统？   │
└──────┬──────────────┘
       │ 是 → AutoGen
       │
       │ 否
       ▼
┌─────────────────────┐
│ 需要可视化调试？     │
└──────┬──────────────┘
       │ 是 → AgentScope
       │
       │ 否
       ▼
┌─────────────────────┐
│ 复杂的状态机流程？   │
└──────┬──────────────┘
       │ 是 → LangGraph
       │
       │ 否
       ▼
     LangChain
```

---

## AutoGen

### 简介

[AutoGen](https://github.com/microsoft/autogen) 是微软开发的多智能体对话框架。

### 核心概念

```
┌─────────────────────────────────────────────────────────────┐
│                    AutoGen 架构                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐                                           │
│  │ ConversableAgent │                                       │
│  │  ┌────────┐  │    · 配置 LLM                             │
│  │  │ system │  │    · 定义人设                             │
│  │  │ prompt │  │    · 设置工具                             │
│  │  └────────┘  │                                           │
│  │  ┌────────┐  │    · 发送消息                              │
│  │  │  tools │  │    · 接收消息                              │
│  │  └────────┘  │                                           │
│  └──────┬───────┘                                           │
│         │                                                    │
│         ▼                                                    │
│  ┌──────────────┐                                           │
│  │  Group Chat  │    管理多智能体对话                          │
│  │              │    · 广播消息                              │
│  │  Agent1 ────┼───→ Agent2                                 │
│  │    │         │    Agent3                                 │
│  │    └─────────┼───→ Agent4                                 │
│  └──────────────┘                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 典型对话模式

#### 1. 一对一对话

```
用户助手模式:

┌─────────┐                      ┌─────────┐
│  User   │ ←─────────────────→ │ Agent   │
│ Agent   │                      │         │
└─────────┘                      └─────────┘

应用场景:
· 问答系统
· 写作助手
· 代码生成
```

#### 2. 两人对话

```
双人协作模式:

┌─────────┐     对话      ┌─────────┐
│ Agent A │ ←──────────→  │ Agent B │
│ (编码员) │               │ (审查员) │
└─────────┘                └─────────┘

工作流程:
1. A 生成代码
2. B 审查代码
3. B 给出反馈
4. A 根据反馈修改
5. 重复直到完成
```

#### 3. 群组对话

```
群组对话模式:

          ┌──────────┐
          │ Manager  │ ← 协调者
          └─────┬────┘
       ╱   │   │   ╲
      ╱    │    │    ╲
     ▼     ▼     ▼     ▼
   ┌────┐┌────┐┌────┐┌────┐
   │Coder│Tester│Reviewer│...
   └────┘└────┘└────┘└────┘

对话流程:
1. Manager 分配任务
2. 指定 Agent 接管对话
3. 该 Agent 完成后交还控制权
4. Manager 决定下一步
```

### 代码示例结构

```
伪代码: AutoGen 基础用法

# 创建助手 Agent
assistant = ConversableAgent(
    name="assistant",
    system_message="你是一个有用的助手",
    llm_config={"model": "gpt-4"}
)

# 创建用户 Agent
user = ConversableAgent(
    name="user",
    human_input_mode="ALWAYS",
    code_execution_config=False
)

# 开始对话
result = user.initiate_chat(
    recipient=assistant,
    message="帮我写一个快速排序"
)
```

### 高级特性

#### 1. 工具使用

```
工具调用流程:

Agent 决定使用工具
       │
       ▼
函数调用信息发送给框架
       │
       ▼
框架执行工具函数
       │
       ▼
结果返回给 Agent
       │
       ▼
Agent 继续对话
```

#### 2. 代码执行

```
代码执行沙盒:

┌──────────────┐
│   Agent      │ 生成代码
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 代码解析器    │ 提取代码块
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  Docker容器  │ 安全执行
│  或 Jupyter  │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  返回输出    │
└──────────────┘
```

---

## AgentScope

### 简介

[AgentScope](https://github.com/modelscope/agentscope) 是阿里达摩院推出的 Agent 开发框架，强调可视化和模块化。

### 核心特性

```
┌─────────────────────────────────────────────────────────────┐
│                 AgentScope 核心特性                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 可视化编排                                                │
│     ┌─────────────────────────────────┐                    │
│     │   ┌───┐    ┌───┐    ┌───┐      │                    │
│     │   │ A │───→│ B │───→│ C │      │                    │
│     │   └───┘    └───┘    └───┘      │                    │
│     │                                 │                    │
│     │   拖拽式构建 Agent 工作流        │                    │
│     └─────────────────────────────────┘                    │
│                                                             │
│  2. 模块化设计                                                │
│     ┌────────┐  ┌────────┐  ┌────────┐                    │
│     │ Agent  │  │ Service│  │  Tool  │                    │
│     │        │──│        │──│        │                    │
│     └────────┘  └────────┘  └────────┘                    │
│     独立开发、测试、复用                                       │
│                                                             │
│  3. 内置服务                                                 │
│     · 文件服务                                               │
│     · 数据库服务                                             │
│     · HTTP 服务                                              │
│     · 消息队列                                               │
│                                                             │
│  4. 调试支持                                                 │
│     · 消息追踪                                               │
│     · 执行回放                                               │
│     · 性能分析                                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Agent 类型

```
AgentScope 的 Agent 类型:

┌──────────────────────────────────────────────────────────┐
│  DialogAgent (对话Agent)                                  │
│  · 基础对话能力                                           │
│  · 配置简单                                               │
│  · 适合单轮任务                                           │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  ReActAgent (推理-行动Agent)                              │
│  · 推理能力                                               │
│  · 工具调用                                               │
│  · 适合复杂任务                                           │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  CodingAgent (代码Agent)                                  │
│  · 代码生成                                               │
│  · 代码执行                                               │
│  · 适合编程任务                                           │
└──────────────────────────────────────────────────────────┘
```

### 工作流示例

```
AgentScope 工作流示例:

[用户输入]
      │
      ▼
┌─────────────┐
│ 意图识别Agent │ → 理解用户想要什么
└──────┬──────┘
       │
       ▼
┌─────────────┐     ┌─────────────┐
│ 工具调用Agent │───→│ API服务     │
└──────┬──────┘     └─────────────┘
       │
       ▼
┌─────────────┐
│ 结果处理Agent │ → 格式化输出
└──────┬──────┘
       │
       ▼
   [返回用户]
```

---

## LangGraph

### 简介

[LangGraph](https://github.com/langchain-ai/langgraph) 是 LangChain 团队开发的基于图结构的 Agent 框架。

### 核心思想

```
┌─────────────────────────────────────────────────────────────┐
│                    LangGraph 核心理念                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Agent = 状态机 + 图结构                                     │
│                                                             │
│  ┌──────┐    ┌──────┐    ┌──────┐    ┌──────┐             │
│  │ 节点1│───→│ 节点2│───→│ 节点3│───→│ 节点4│             │
│  └──┬───┘    └──┬───┘    └──┬───┘    └──┬───┘             │
│     │          │          │          │                   │
│     │   ┌──────┘          └──────┬───┘                   │
│     │   │  条件边                 │                      │
│     │   │   根据状态决定           │                      │
│     │   │   下一个节点              │                      │
│     └───┴──────────────────────────┘                      │
│                                                             │
│  优势:                                                      │
│  · 清晰的执行流程                                           │
│  · 灵活的路由控制                                           │
│  · 易于调试和扩展                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 图结构设计

```
典型图结构:

        ┌──────────┐
        │  Start   │
        └────┬─────┘
             │
             ▼
        ┌──────────┐
        │  Agent   │ ──┐
        │ (思考)   │   │ 循环
        └────┬─────┘   │
             │        │
             ▼        │
        ┌──────────┐   │
        │  条件判断  │◄──┘
        └────┬─────┘
             │
      ┌──────┴──────┐
      │             │
      ▼             ▼
 ┌─────────┐   ┌─────────┐
 │ 完成    │   │ 继续尝试 │
 └─────────┘   └─────────┘
```

### 状态管理

```
状态流转:

初始状态:
{
  "messages": [],
  "current_step": "start",
  "attempts": 0
}

         ↓
Agent 处理后:
{
  "messages": [msg1, msg2],
  "current_step": "processing",
  "attempts": 1
}

         ↓
条件判断后:
{
  "messages": [msg1, msg2],
  "current_step": "done",  // 或 "retry"
  "attempts": 1
}
```

---

## 框架实战案例

### 案例：代码审查系统

使用 AutoGen 实现双人代码审查：

```
系统设计:

┌──────────────┐          ┌──────────────┐
│  Coder Agent │ ←───────→│Reviewer Agent│
│   (编码员)    │          │   (审查员)    │
└──────────────┘          └──────────────┘

对话流程:
1. User → Coder: "写一个快速排序"
2. Coder → Reviewer: [代码]
3. Reviewer → Coder: "有bug，边界条件没处理"
4. Coder → Reviewer: [修复后的代码]
5. Reviewer → User: "代码通过审查"
```

### 案例：任务规划系统

使用 AgentScope 实现任务规划：

```
系统架构:

用户请求
      │
      ▼
┌─────────────┐
│规划Agent    │ 分解任务
└──────┬──────┘
       │
       ├─────→┐
       │      │
       ▼      ▼
    ┌────┐┌────┐
    │Tool││Tool│
    │Agent│Agent│
    └────┘└────┘
       │      │
       └──┬───┘
          ▼
   ┌─────────────┐
   │汇总Agent    │
   └─────────────┘
          │
          ▼
      返回结果
```

### 案例：客服系统

使用 LangGraph 实现智能客服：

```
状态机设计:

[用户消息]
      │
      ▼
┌─────────┐
│意图识别  │
└────┬────┘
     │
     ├─→ 查询 ──→ [知识库检索] ──→ [回答]
     │
     ├─→ 投诉 ──→ [工单创建] ──→ [转人工]
     │
     └─→ 其他 ──→ [兜底回复]

每个节点都是一个 Agent，根据条件路由到不同节点
```

---

## 框架选择指南

### 决策树

```
项目需求分析:

开始
  │
  ▼
需要多智能体协作？
  │
  ├─ 是 ──→ 需要可视化？
  │         │
  │         ├─ 是 ──→ AgentScope
  │         │
  │         └─ 否 ──→ AutoGen
  │
  └─ 否 ──→ 流程复杂？
            │
            ├─ 是 ──→ LangGraph
            │
            └─ 否 ──→ LangChain
```

### 对比总结

| 框架 | 最佳场景 | 学习曲线 | 社区活跃度 |
|------|---------|---------|-----------|
| AutoGen | 多智能体对话 | 中等 | 中等 |
| AgentScope | 快速开发+可视化 | 较低 | 中等（中文） |
| LangGraph | 复杂状态机 | 较高 | 高 |
| LangChain | 通用场景 | 低 | 很高 |

---

## 练习作业

### 基础练习
1. 使用 AutoGen 创建双人对话
2. 使用 AgentScope 创建简单工作流
3. 使用 LangGraph 创建简单的状态图

### 进阶练习
4. 构建一个代码审查系统
5. 实现一个任务规划 Agent
6. 创建一个三智能体协作系统

### 挑战练习
7. 构建完整的客服系统
8. 实现自主编程 Agent
9. 设计复杂的多智能体协作场景

## 学习资源

### 官方文档
- [AutoGen 官方文档](https://microsoft.github.io/autogen/)
- [AgentScope 官方文档](https://agentscope.io/)
- [LangGraph 官方文档](https://langchain-ai.github.io/langgraph/)

### 教程
- AutoGen GitHub 示例
- AgentScope 官方教程
- LangChain Academy

### 社区
- AutoGen Discord
- AgentScope 钉钉群
- LangChain 社区

## 下一步

完成本章学习后，进入：
- [第7章：构建Agent框架](../ch07-custom-framework/) - 从零构建自己的框架

## 学习检查

- [ ] 了解主流 Agent 框架
- [ ] 掌握 AutoGen 的基本使用
- [ ] 掌握 AgentScope 的基本使用
- [ ] 了解 LangGraph 的图结构
- [ ] 能够选择合适的框架
- [ ] 完成章节练习题
